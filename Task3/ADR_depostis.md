### **Название задачи: ADR-1. Концептуальная архитектура MVP процесса открытия депозитов
### **Автор:** Гармаш Вячеслав Борисович
### **Дата:** 2025-10-25
### **Функциональные требования**

| № | Действующие лица или системы | Use Case | Описание |
| :-: | :- | :- | :- |
| 1 | Клиент (новый), Сайт, Кол-центр | Подача заявки на депозит с сайта | 1. Клиент на сайте просматривает список депозитов.<br>2. Выбирает продукт и оставляет заявку (ФИО, номер телефона).<br>3. Заявка шифруется и передается в систему кол-центра.<br>4. Менеджер кол-центра видит заявку, звонит клиенту для консультации и может предложить особые условия.<br>5. Клиент приходит в отделение для идентификации и завершения оформления. |
| 2 | Клиент (существующий), Интернет-банк (ИБ), АБС, СМС-шлюз | Онлайн-открытие депозита через ИБ | 1. Авторизованный клиент в ИБ видит список депозитов с персонализированными ставками.<br>2. Клиент выбирает депозит, сумму и счет списания.<br>3. Система запрашивает подтверждение операции через SMS-код.<br>4. Клиент вводит код.<br>5. Заявка на открытие депозита создается в АБС асинхронно (через буфер).<br>6. Клиент получает SMS-уведомление об успешной подаче заявки. |
| 3 | Менеджер бэк-офиса, АБС | Обработка заявки на депозит в бэк-офисе | 1. Менеджер бэк-офиса видит в АБС новую заявку из ИБ.<br>2. Менеджер проверяет данные и подтверждает открытие депозита.<br>3. АБС фиксирует операцию, средства резервируются/списываются.<br>4. Клиенту отправляется финальное SMS-уведомление об открытии депозита. |
| 4 | Сотрудник бэк-офиса, Сервис управления продуктами | Управление ставками по депозитам | 1. Сотрудник бэк-офиса через веб-интерфейс просматривает и редактирует актуальные ставки по депозитным продуктам.<br>2. Изменения сохраняются в базе данных сервиса.<br>3. Сайт и ИБ получают актуальные данные через API сервиса. |

### **Нефункциональные требования**

| № | Требование |
| :-: | :- |
| 1 | **Надежность (R1):** Доступность новых сервисов и ИБ - 99.9% |
| 2 | **Надежность (R2):** Изоляция АБС от прямой нагрузки из интернет-каналов. Все интеграции должны быть асинхронными |
| 3 | **Производительность (P1):** Время отклика UI (загрузка списка депозитов, подача заявки) < 1 сек |
| 4 | **Производительность (P2):** Новые сервисы должны поддерживать горизонтальное масштабирование |
| 5 | **Безопасность (DC3):** Все данные при передаче должны быть защищены с помощью TLS 1.2+ |
| 6 | **Поддерживаемость (S1):** Максимальное использование существующих технологий банка (Java, Spring Boot, MS SQL, Oracle) |
| 7 | **Поддерживаемость (S2):** Для асинхронной коммуникации использовать Kafka или БД |
| 8 | **Ограничение реализации (IC1):** Избегать доработок ядра ИБ силами подрядчика |

### **Решение**

#### Архитектурно значимые решения:

1. **Изоляция АБС (Требование R2):** Ключевой драйвер архитектуры. Прямые синхронные вызовы API АБС из интернет-каналов запрещены. Это приводит к решению использовать **асинхронный буфер** (Kafka) для передачи заявок из ИБ в АБС.
1. **Обход ограничений ИБ (Требование IC1):** Так как доработка монолита ИБ на .NET 4.5 нежелательна, новая функциональность (работа с депозитами) выносится в отдельный **микросервис на Java (Deposit Service)**, который взаимодействует с ИБ через его публичное API (если возможно) или напрямую с фронтендом. Это позволяет использовать современный стек (Kafka, Spring Boot) и независимо масштабировать новую функциональность.
1. **Централизация данных о продуктах (Требование F3):** Создается отдельный **Product Service** для хранения и управления ставками. Это устраняет зависимость от XLS-файлов, обеспечивает консистентность данных на сайте и в ИБ и разгружает АБС от справочной информации.
1. **Унификация коммуникаций (Требование F5, S2):** Создается отдельный **Notification Service**, который инкапсулирует логику работы с СМС-шлюзом. Это позволяет избежать доработки ядра ИБ для отправки новых типов уведомлений и создает единую точку для управления коммуникациями.
1. **Обеспечение производительности (Требование P1, U1):** Для обеспечения времени отклика <1 сек вводится агрессивное **кэширование** справочной информации (списков депозитов) на уровне Product Service и на фронтенде.