# Архитектурное решение (ADR): Интеграция кол-центров с системой управления ставками

## Название задачи
Интеграция систем кол-центра и партнёрского кол-центра с процессом управления депозитными ставками

## Автор
Архитектор

## Дата
2024-06-19

## Функциональные требования

| № | Действующие лица или системы | Use Case | Описание |
|---|-----------------------------|----------|-----------|
| 1 | Менеджер кол-центра, Система кол-центра, Product Service | Консультация клиента по актуальным ставкам | 1. Клиент звонит в кол-центр.<br>2. Менеджер открывает интерфейс системы кол-центра.<br>3. Система запрашивает актуальные ставки через API Product Service.<br>4. Менеджер консультирует клиента на основе полученных данных. |
| 2 | Администратор бэк-офиса, Product Service, Партнёрский кол-центр | Выгрузка ставок для партнёрского кол-центра | 1. Администратор запускает процесс выгрузки.<br>2. Product Service формирует файл с актуальными ставками.<br>3. Файл передаётся через SFTP на сервер партнёрского кол-центра.<br>4. Система партнёра загружает данные в свою БД. |
| 3 | Менеджер партнёрского кол-центра, Локальная БД ставок | Консультация клиента по ставкам (партнёр) | 1. Клиент звонит в партнёрский кол-центр.<br>2. Менеджер открывает локальную систему.<br>3. Система показывает ставки из локальной БД (обновлённой через файлы).<br>4. Менеджер консультирует клиента. |

## Нефункциональные требования

| № | Требование |
|---|------------|
| 1 | **Доступность**: Product Service должен быть доступен 99.9% для кол-центра банка |
| 2 | **Безопасность**: Передача файлов партнёру должна использовать шифрование (SFTP) |
| 3 | **Производительность**: Запрос ставок из кол-центра должен выполняться < 500 мс |
| 4 | **Надёжность**: Процесс выгрузки файлов должен быть устойчив к сетевым сбоям |
| 5 | **Совместимость**: Файлы для партнёра должны быть в согласованном формате (JSON/CSV) |

## Решение

### Архитектурные решения

1. **Прямая интеграция кол-центра банка** через REST API к Product Service для реального времени
2. **Файловая интеграция с партнёрским кол-центром** через SFTP для соблюдения их ограничений
3. **Расширение Product Service** для поддержки обоих сценариев

### Недостатки, ограничения, риски

- Задержка данных: У партнёрского кол-центра данные обновляются по расписанию, а не в реальном времени
- Сложность мониторинга: Трудно отслеживать успешность доставки файлов партнёру
- Ошибки формата: Риск несовместимости форматов файлов при изменениях

### Риски
- Перегрузка Product Service: При большом количестве запросов из кол-центра
- Потеря файлов: При сбоях SFTP-передачи
- Неактуальные данные: У партнёра при сбоях процесса выгрузки